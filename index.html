<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WUSDT - Pré-venda</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
  <style>
    .dropdown-toggle { 
      width: 100%; 
      padding: 10px; 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      background: #f0f0f0; 
      border: none; 
      cursor: pointer; 
    }
    .pay-with-content { display: flex; justify-content: space-between; }
    .pay-with-content-left { flex: 1; }
  </style>
</head>
<body>
  <div class="mb-20 container">
    <div class="row">
      <div class="col-md-12">
        <div class="mb-20 text-center">
          <div class="presale-card">
            <div class="pay-with-content">
              <div class="pay-with-content-left">
                <button class="dropdown-toggle" id="buyWithETH">
                  <img src="/src/assets/images/token/eth.png" alt="ícone"> 
                  <span>Compre com ETH</span>
                </button>
              </div>
              <div class="pay-with-content-right">
                <iframe src="https://www.dextools.io/app/en/bnb/pair-explorer/0xAB6dB09EBA09af77C215133241939c6c8f250128" 
                        width="300" height="200" frameborder="0" 
                        style="display: inline-block;"></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const buyWithETHButton = document.getElementById('buyWithETH');
      buyWithETHButton.addEventListener('click', async function() {
        if (typeof window.ethereum !== 'undefined') {
          try {
            // Conectar à MetaMask
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            const web3 = new Web3(window.ethereum);
            const accounts = await web3.eth.getAccounts();
            const userAddress = accounts[0];

            // Configurar a transação para comprar WUSDT
            const contractAddress = '0xAB6dB09EBA09af77C215133241939c6c8f250128'; // Endereço WUSDT
            const amount = web3.utils.toWei('1', 'ether'); // Exemplo: 1 ETH
            const routerAddress = '0x10ED43C718714eb63d5aA57B78B54704E256024E'; // PancakeSwap Router (BNB Chain)

            const data = web3.eth.abi.encodeFunctionCall({
              name: 'swapExactETHForTokens',
              type: 'function',
              inputs: [{
                type: 'uint256',
                name: 'amountOutMin'
              }, {
                type: 'address[]',
                name: 'path'
              }, {
                type: 'address',
                name: 'to'
              }, {
                type: 'uint256',
                name: 'deadline'
              }]
            }, ['0', ['0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c', contractAddress], userAddress, Math.floor(Date.now() / 1000) + 60 * 20]);

            // Enviar transação
            await web3.eth.sendTransaction({
              from: userAddress,
              to: routerAddress,
              value: amount,
              data: data
            });
            alert('Compra realizada com sucesso!');
          } catch (error) {
            console.error('Erro na transação:', error);
            alert('Falha ao realizar a compra.');
          }
        } else {
          alert('MetaMask não detectada. Instale a MetaMask para continuar.');
        }
      });
    });
  </script>
</body>
</html>
